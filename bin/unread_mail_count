#!/usr/bin/env python

"""
Fetches current total ammount of unread messages of all the given accounts
from the Geary mail application database.
"""

import sys
import sqlite3

def fetch_unread_count(user, mailbox):
    db_path = '/home/%s/.local/share/geary/%s/geary.db' % (user, mailbox)
    conn = sqlite3.connect(db_path)
    c = conn.execute('SELECT unread_count FROM FolderTable WHERE name="INBOX"')
    return c.fetchone()[0]

if __name__ == '__main__':
  if len(sys.argv) >= 3:
    user = sys.argv[1]
    mailboxes = sys.argv[2:]
    print(sum(fetch_unread_count(user, x) for x in mailboxes))
